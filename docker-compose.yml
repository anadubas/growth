---
name: ${GROWTH_PROJECT_NAME:-growth}

include:
  - path: ./priv/docker/services/observability/docker-compose.yml

services:
  growth:
    image: "anadubas/growth:${GROWTH_TAG:-dev}"
    build: .
    pull_policy: never
    init: true
    hostname: growth
    restart: unless-stopped
    develop:
      watch:
        - path: ./
          action: rebuild
    ports:
      - "${GROWTH_PORT:-:4000}"
    environment:
      SECRET_KEY_BASE: "${GROWTH_SECRET_KEY_BASE:-mVrA1wyJvtAVp0hIgT2DnZMfyWh5dPltmEUWYVXN2yp8O742eTeL7sEe4NH9pskF}"
      PHX_HOST: "${GROWTH_PHX_HOST:-127.0.0.1}"
      PHX_PORT: "${GROWTH_PHX_PORT:-4000}"
      PHX_SCHEME: "${GROWTH_PHX_SCHEME:-http}"
      RELEASE_DISTRIBUTION: name
    labels:
      "growth.scrape": "true"
      "growth.port": 4000
      "growth.path": /metrics

  live:
    image: "ghcr.io/livebook-dev/livebook:0.17.2"
    init: true
    hostname: live
    restart: unless-stopped
    ports:
      - "${LIVE_PORT:-:8080}"
    environment:
      # NOTE: (jpd) The `LIVEBOOK_PASSWORD` must be at least 12 characters long. Can be generated with `openssl rand -hex 12`
      LIVEBOOK_PASSWORD: "${LIVEBOOK_PASSWORD:-19ec878a6244c686de2eac0b}"
      LIVEBOOK_COOKIE: "${LIVEBOOK_COOKIE:-some_cookie}"
      # NOTE: (jpd) The `LIVEBOOK_SECRET_KEY_BASE` must be at least 64 characters long. Can be generated with `openssl rand -base64 48`
      LIVEBOOK_SECRET_KEY_BASE: "${LIVEBOOK_SECRET_KEY_BASE:-aoGX5w1paBZX4WBOpLRN7YHmEJjN7ybqEavsWly91EzrY44dYN4P2vIjm+2sD76F}"
      LIVEBOOK_HOME: /data
    volumes:
      - "live_data:/data"

volumes:
  live_data: {}
